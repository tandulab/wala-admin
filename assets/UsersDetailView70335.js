import{k as d,j as O,u as j,h as G,i as H,c as A,z as Y,G as y,s as S,m as p,n as k,B as q,U as K,M as J,_ as Q,a as g,d as i,b as m,w as W,K as X,r as f,o as C,f as Z,e as b,v as w}from"../index70335.js";import"./moment70335.js";import{h as u,s as x}from"./loader70335.js";const $={setup(){const V=d({icon:"pi pi-home",to:"/referenti"}),l=d(""),h=d([{label:""}]),a=O(),n=j(),r=G(),t=d({}),E=H(),c=d(!1),_=d(!1),v=d(!1),T=A(()=>n.getters[q.CURRENT_COMPANIES]),o=A(()=>n.getters[K.CURRENT_USER]),B=async function(){try{return await n.dispatch(J.FETCH_ALL_COMPANIES)}catch(e){u(n),p(r,e)}},D=async function(){try{const e=await n.dispatch(y.FETCH_USER_DETAIL,a.params.id+"");return F(),e}catch(e){u(n),p(r,e)}},I=async function(){if(N()||U()||R())return;x(n);const e={user:t.value};try{const s=await n.dispatch(y.UPDATE_USER,e);return S(r,{message:"Referente aggiornato correttamente.",title:""}),k.replace({name:"referenti"}),u(n),s}catch(s){u(n),p(r,s)}},L=async function(){if(N()||U()||R())return;x(n);const e={user:t.value};try{const s=await n.dispatch(y.CREATE_USER,e);return S(r,{message:"Referente creato correttamente.",title:""}),k.replace({name:"referenti"}),u(n),s}catch(s){u(n),p(r,s)}},F=function(){var e;t.value.id=o.value.id,t.value.first_name=o.value.first_name,t.value.last_name=o.value.last_name,t.value.email=o.value.email,t.value.company_id=(e=o.value.company)==null?void 0:e.id},P=function(){l.value!=""&&t.value.id?I():L()},U=function(){var e,s;return((e=t.value)==null?void 0:e.last_name)==""||((s=t.value)==null?void 0:s.last_name)==null?_.value=!0:_.value=!1,_.value},N=function(){var e,s;return((e=t.value)==null?void 0:e.first_name)==""||((s=t.value)==null?void 0:s.first_name)==null?c.value=!0:c.value=!1,c.value},R=function(){var e,s;return((e=t.value)==null?void 0:e.email)==""||((s=t.value)==null?void 0:s.email)==null?v.value=!0:v.value=!1,v.value},z=e=>{E.require({target:e.currentTarget,message:"Sei sicuro di voler inviare le credenziali?",icon:"pi pi-info-circle",acceptClass:"p-button-danger",accept:()=>{M()}})},M=async function(){try{const e=await n.dispatch(y.AUTH_SEND_CREDENTIALS,t.value.id);return S(r,{message:"Credenziali inviate correttamente.",title:""}),e}catch(e){u(n),p(r,e)}};return Y(async()=>{B(),l.value=a.params.id+"",l.value!=""?(D(),h.value[0]={label:"Modifica referente"}):h.value[0]={label:"Nuovo referente"}}),{user_detail:o,home:V,items:h,response:T,tmp_user:t,invalid_first_name:c,invalid_last_name:_,invalid_email:v,saveUser:P,validateLastName:U,validateFirstName:N,validateEmail:R,confirmSendCredential:z}},components:{}};const ee={class:"m-4"},ae={class:"flex align-items-center justify-content-between"},te=i("h1",null,"REFERENTE",-1),ne={class:"formgrid grid col-10"},oe={class:"field col-6"},se=i("label",{for:"name"},"Nome*",-1),le={key:0,id:"name",class:"p-error"},ie={class:"field col-6"},re=i("label",{for:"name"},"Cognome*",-1),ce={key:0,id:"name",class:"p-error"},me={class:"field col-6"},de=i("label",{for:"name"},"Email*",-1),ue={key:0,id:"name",class:"p-error"},_e={class:"field col-6"},ve=i("label",{for:"company"},"Azienda",-1),fe={class:"flex justify-content-end"};function pe(V,l,h,a,n,r){const t=f("Breadcrumb"),E=f("Button"),c=f("InputText"),_=f("Dropdown"),v=f("Card"),T=f("ConfirmPopup");return C(),g(X,null,[i("div",ee,[m(t,{home:a.home,model:a.items,class:"mb-3 mt-0 pt-0"},null,8,["home","model"]),m(v,null,{content:W(()=>[i("div",ae,[te,a.tmp_user.id?(C(),Z(E,{key:0,label:"Invia credenziali",onClick:l[0]||(l[0]=o=>a.confirmSendCredential(o)),class:"p-button-outlined"})):b("",!0)]),i("div",ne,[i("div",oe,[se,m(c,{id:"name",type:"text",modelValue:a.tmp_user.first_name,"onUpdate:modelValue":l[1]||(l[1]=o=>a.tmp_user.first_name=o),class:w(["w-full",{"p-invalid":a.invalid_first_name}]),onChange:a.validateFirstName},null,8,["modelValue","class","onChange"]),a.invalid_first_name?(C(),g("small",le,"Campo obbligatorio.")):b("",!0)]),i("div",ie,[re,m(c,{id:"name",type:"text",modelValue:a.tmp_user.last_name,"onUpdate:modelValue":l[2]||(l[2]=o=>a.tmp_user.last_name=o),class:w(["w-full",{"p-invalid":a.invalid_last_name}]),onChange:a.validateLastName},null,8,["modelValue","class","onChange"]),a.invalid_last_name?(C(),g("small",ce,"Campo obbligatorio.")):b("",!0)]),i("div",me,[de,m(c,{id:"name",type:"text",modelValue:a.tmp_user.email,"onUpdate:modelValue":l[3]||(l[3]=o=>a.tmp_user.email=o),class:w(["w-full",{"p-invalid":a.invalid_email}]),onChange:a.validateEmail},null,8,["modelValue","class","onChange"]),a.invalid_email?(C(),g("small",ue,"Campo obbligatorio.")):b("",!0)]),i("div",_e,[ve,m(_,{modelValue:a.tmp_user.company_id,"onUpdate:modelValue":l[4]||(l[4]=o=>a.tmp_user.company_id=o),options:a.response.companies,optionLabel:"name",optionValue:"id",id:"company",class:"w-full"},null,8,["modelValue","options"])])]),i("div",fe,[m(E,{label:"Salva",onClick:a.saveUser},null,8,["onClick"])])]),_:1})]),m(T)],64)}const ye=Q($,[["render",pe]]);export{ye as default};
