import{g as N,F as V,u as E,h as B,i as O,k as _,c as T,G as S,m as C,n as P,s as K,U as R,_ as x,a as h,b as r,w as v,r as m,o as g,p as F,q as L,t as k,x as U,y as z,d as A,e as I}from"../index34382.js";import{h as q}from"./moment34382.js";import{h as G}from"./loader34382.js";const $={setup(){N(()=>{f.value=!0,t.value={first:0,rows:o.value.rows,sortField:null,sortOrder:null,filters:c.value};const e=localStorage.getItem("dt-users");if(t.value.page==null&&e){let n=JSON.parse(e);t.value.first=n.first,t.value.page=n.first/t.value.rows}V.register("myfilter",(n,D)=>n===D),u()});const l=E(),a=B(),w=O(),o=_(),c=_({email:{value:"",matchMode:"contains"},first_name:{value:"",matchMode:"contains"},last_name:{value:"",matchMode:"contains"}}),f=_(!0),t=_(),i=_(0),p=_([{label:"My Filter",value:"myfilter"}]),y=T(()=>l.getters[R.CURRENT_USERS]);function u(){f.value=!0;const e=new Map;e.set("role","admin"),e.set("email",c.value.email.value),e.set("first_name",c.value.first_name.value),e.set("last_name",c.value.last_name.value),e.set("page",t.value.page+1),e.set("per_page",t.value.rows),t.value.sortField&&(t.value.sortOrder==1?e.set("sorted_by",t.value.sortField+"_asc"):e.set("sorted_by",t.value.sortField+"_desc")),setTimeout(()=>{b(e)},Math.random()*1e3+250)}const b=async function(e){try{const n=await l.dispatch(S.FETCH_ALL_USERS,e);return f.value=!1,n}catch(n){G(l),C(a,n)}},s=async function(e){await l.dispatch(S.DELETE_USER,e).then(()=>{K(a,{message:"Referente eliminato correttamente.",title:""}),u()}).catch(n=>{C(a,n)})};return{dt:o,response:y,filters:c,loading:f,totalRecords:i,lazyParams:t,loadLazyData:u,matchModes:p,onPage:e=>{t.value=e,u()},onSort:e=>{t.value=e,u()},onFilter:()=>{t.value.page=0,t.value.filters=c.value,u()},confirmDeleteUser:(e,n)=>{w.require({target:e.currentTarget,message:"Sei sicuro di voler eliminare questo referente?",icon:"pi pi-info-circle",acceptClass:"p-button-danger",accept:()=>{s(n)}})},toggleEdit:function(e){P.push({name:"dettaglio-referente",params:{id:e.id}})},moment:q}}};function j(l,a,w,o,c,f){const t=m("InputText"),i=m("Column"),p=m("Button"),y=m("DataTable"),u=m("ConfirmPopup"),b=z("tooltip");return g(),h("div",null,[r(y,{value:o.response.users,totalRecords:o.response.total,lazy:!0,paginator:!0,rows:30,filters:o.filters,"onUpdate:filters":a[0]||(a[0]=s=>o.filters=s),ref:"dt",dataKey:"id",loading:o.loading,onPage:a[1]||(a[1]=s=>o.onPage(s)),onSort:a[2]||(a[2]=s=>o.onSort(s)),onFilter:a[3]||(a[3]=s=>o.onFilter()),filterDisplay:"row",stateStorage:"local",stateKey:"dt-users",removableSort:""},{empty:v(()=>[F(" Nessun referente trovato. ")]),default:v(()=>[r(i,{field:"email",header:"Email",filterMatchMode:"contains",ref:"email",sortable:!0,showFilterMatchModes:!1,showFilterOperator:!1,showFilterMenu:!1},{filter:v(({filterModel:s,filterCallback:d})=>[r(t,{type:"text",modelValue:s.value,"onUpdate:modelValue":M=>s.value=M,onKeydown:L(M=>d(),["enter"]),class:"p-column-filter",placeholder:"Filtra per email"},null,8,["modelValue","onUpdate:modelValue","onKeydown"])]),_:1},512),r(i,{field:"first_name",header:"Nome",filterMatchMode:"contains",ref:"first_name",sortable:!1,showFilterMatchModes:!1,showFilterOperator:!1,showFilterMenu:!1},null,512),r(i,{field:"last_name",header:"Cognome",filterMatchMode:"contains",ref:"last_name",sortable:!1,showFilterMatchModes:!1,showFilterOperator:!1,showFilterMenu:!1},null,512),r(i,{field:"company",header:"Azienda",sortable:!1},{body:v(({data:s})=>{var d;return[F(k(((d=s.company)==null?void 0:d.name)||"-"),1)]}),_:1}),r(i,{header:"",style:{width:"9rem"}},{body:v(({data:s})=>[U(r(p,{type:"button",onClick:d=>o.toggleEdit(s),"aria-haspopup":"true","aria-controls":"overlay_menu",class:"p-button-text p-button-rounded text-300 surface-200 mr-3",icon:"pi pi-pencil"},null,8,["onClick"]),[[b,"Modifica",void 0,{top:!0}]]),U(r(p,{type:"button",onClick:d=>o.confirmDeleteUser(d,s.id),"aria-haspopup":"true","aria-controls":"overlay_menu",class:"p-button-text p-button-rounded text-300 surface-200",icon:"pi pi-trash"},null,8,["onClick"]),[[b,"Elimina",void 0,{top:!0}]])]),_:1})]),_:1},8,["value","totalRecords","filters","loading"]),r(u)])}const H=x($,[["render",j]]),J={setup(){const l=E();return{users:T(()=>l.getters[R.CURRENT_USERS])}},components:{UsersTable:H}},Q={class:"flex justify-content-between align-items-center"},W={key:0,class:"uppercase"},X={key:0},Y={key:1};function Z(l,a,w,o,c,f){const t=m("Button"),i=m("UsersTable"),p=m("Card");return g(),h("div",null,[r(p,null,{content:v(()=>[A("div",Q,[o.users?(g(),h("h1",W,[o.users.total==1?(g(),h("span",X," 1 Referente")):(g(),h("span",Y,k(o.users.total)+" Referenti",1))])):I("",!0),r(t,{label:"Nuovo referente",onClick:a[0]||(a[0]=y=>l.$router.push("/dettaglio-referente"))})]),r(i)]),_:1})])}const ne=x(J,[["render",Z]]);export{ne as default};
