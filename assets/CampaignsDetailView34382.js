import{k as m,j as ia,u as sa,h as ca,i as da,c as x,z as ra,l as N,s as I,m as g,n as B,B as ma,D as _a,U as ua,C as pa,Q as va,E as fa,G as ga,I as Ca,_ as ha,a as A,b as c,w as y,r as _,o as T,d as i,e as w,v as V}from"../index34382.js";import{h as R}from"./moment34382.js";import{Q as Ea}from"./QuestionsList34382.js";import{s as L,h as p}from"./loader34382.js";const Aa={setup(){const k=m({icon:"pi pi-home",to:"/campagne"}),l=m(""),D=m([{label:""}]),e=ia(),n=sa(),r=ca(),t=m({}),u=m({}),U="6d503a06-958b-4f83-af8d-92e39ced2f74",Y=m(File),v=m(!1),b=m(!1),f=m(!1),C=m(!1),h=m(!1),S=da(),M=x(()=>n.getters[ma.CURRENT_COMPANIES]),s=x(()=>n.getters[_a.CURRENT_AUDIENCES]),z=x(()=>n.getters[ua.CURRENT_USERS]),d=x(()=>n.getters[pa.CURRENT_CAMPAIGN]),H=x(()=>n.getters[va.CURRENT_QUESTIONS]),j=async function(){try{return await n.dispatch(fa.FETCH_ALL_AUDIENCES)}catch(a){p(n),g(r,a)}},Z=async function(){const a=new Map;a.set("roles","admin");try{return await n.dispatch(ga.FETCH_ALL_USERS,a)}catch(o){p(n),g(r,o)}},J=async function(){try{return await n.dispatch(Ca.FETCH_ALL_CAMPAIGN_QUESTIONS,e.params.id+"")}catch{p(n)}},P=async function(){L(n);try{const a=await n.dispatch(N.FETCH_CAMPAIGN_DETAIL,e.params.id+"");return X(),p(n),a}catch(a){p(n),g(r,a)}},G=function(){const a=new FormData;u.value&&u.value.name&&a.append("campaign[logo]",u.value);let o=t.value.start_at!==""?R(t.value.start_at,"DD/MM/YYYY").format("YYYY-MM-DD"):"",la=t.value.end_at!==""?R(t.value.end_at,"DD/MM/YYYY").format("YYYY-MM-DD"):"";for(const E in t.value)E=="start_at"?a.append(`campaign[${E}]`,o):E=="end_at"?a.append(`campaign[${E}]`,la):a.append(`campaign[${E}]`,t.value[E]+"");return delete t.value.logo_url,a},K=async function(){L(n);const a={campaign_id:t.value.id,formData:G()};try{const o=await n.dispatch(N.UPDATE_CAMPAIGN,a);return I(r,{message:"Campagna aggiornata correttamente.",title:""}),P(),B.replace({name:"campagne"}),p(n),o}catch(o){p(n),g(r,o)}},W=async function(){L(n);const a={formData:G()};a.formData.append("campaign[template_questionnaire_id]",U);try{const o=await n.dispatch(N.CREATE_CAMPAIGN,a);return I(r,{message:"Campagna creata correttamente.",title:""}),B.replace({name:"campagne"}),p(n),o}catch(o){p(n),g(r,o)}},X=function(){t.value.id=d.value.id,t.value.name=d.value.name,t.value.start_at=R.unix(d.value.start_at).format("DD/MM/YYYY"),t.value.end_at=R.unix(d.value.end_at).format("DD/MM/YYYY"),t.value.audience_id=d.value.audience_id,t.value.finish_email_text_it=d.value.finish_email_text_it!=null?d.value.finish_email_text_it:"",t.value.intro_text_it=d.value.intro_text_it!=null?d.value.intro_text_it:"",t.value.welcome_email_text_it=d.value.welcome_email_text_it!=null?d.value.welcome_email_text_it:"",t.value.logo_url=d.value.logo_url,t.value.status=d.value.status},$=function(){q()||O()||F()||Q()||(l.value!=""&&t.value.id?K():W())},F=function(){var a,o;return((a=t.value)==null?void 0:a.start_at)==""||((o=t.value)==null?void 0:o.start_at)==null?C.value=!0:C.value=!1,C.value},Q=function(){var a,o;return((a=t.value)==null?void 0:a.end_at)==""||((o=t.value)==null?void 0:o.end_at)==null?h.value=!0:h.value=!1,h.value},q=function(){var a,o;return((a=t.value)==null?void 0:a.name)==""||((o=t.value)==null?void 0:o.name)==null?v.value=!0:v.value=!1,v.value},O=function(){var a,o;return((a=t.value)==null?void 0:a.audience_id)==""||((o=t.value)==null?void 0:o.audience_id)==null?f.value=!0:f.value=!1,f.value},aa=a=>{t.value.logo_url="",u.value=a.files[0]},ea=a=>{S.require({target:a.currentTarget,message:"Sei sicuro di voler mandare un recall agli utenti che non hanno ancora compilato il questionario?",icon:"pi pi-info-circle",acceptClass:"p-button-warning",accept:()=>{oa()}})},ta=a=>{S.require({target:a.currentTarget,message:"Sei sicuro di voler inviare le credenziali?",icon:"pi pi-info-circle",acceptClass:"p-button-danger",accept:()=>{na()}})},na=async function(){await n.dispatch(N.SEND_CREDENTIALS,t.value.id).then(()=>{I(r,{message:"Credenziali inviate correttamente.",title:""})}).catch(a=>{g(r,a)})},oa=async function(){await n.dispatch(N.SEND_RECALL,t.value.id).then(()=>{I(r,{message:"Recall inviato correttamente.",title:""})}).catch(a=>{g(r,a)})};return ra(async()=>{j(),Z(),l.value=e.params.id+"",l.value!=""?(P(),J(),D.value[0]={label:"Modifica campagna"}):D.value[0]={label:"Nuova campagna"}}),{campaign_detail:d,home:k,items:D,response_companies:M,response_audiences:s,users:z,tmp_campaign:t,invalid_name:v,invalid_company:b,invalid_audience:f,invalid_start_at:C,invalid_end_at:h,uploadedFile:u,file:Y,campaign_questions:H,saveCampaign:$,validateStartAt:F,validateEndAt:Q,validateName:q,validateAudience:O,confirmSendQuestionnaire:ta,onSelectedFiles:aa,confirmSendRecall:ea}},components:{QuestionsList:Ea}};const Ta={class:"m-4"},ba={class:"flex align-items-center justify-content-between"},xa=i("h1",null,"CAMPAGNA",-1),Na={key:0},wa={class:"formgrid grid col-10"},Da={class:"field col-6"},Sa=i("label",{for:"name"},"Nome campagna*",-1),Ia={key:0,id:"name",class:"p-error"},ya={class:"field col-6"},Va=i("label",{for:"audience"},"Audience*",-1),Ra={key:0,id:"company",class:"p-error"},Ua=i("div",{class:"field col-6"},null,-1),Ya={class:"my-0 col-12 flex flex-wrap mx-0"},Ma={class:"field col-6 flex flex-column pl-0"},La=i("label",{for:"start_at"},"Data inizio*",-1),ka={key:0,id:"end_at",class:"p-error"},Pa={class:"field col-6 flex flex-column pr-0"},Ga=i("label",{for:"end_at"},"Data fine*",-1),Fa={key:0,id:"end_at",class:"p-error"},Qa={class:"my-0 col-12 flex flex-wrap mx-0"},qa={class:"field col-6 pl-0"},Oa=i("label",{for:"note"},"Intro questionario",-1),Ba={class:"field col-6 pl-0"},za=i("label",{for:"note"},"Intro email",-1),Ha={class:"field col-6 pl-0"},ja=i("label",{for:"note"},"Fine email",-1),Za={class:"flex justify-content-end"};function Ja(k,l,D,e,n,r){const t=_("Breadcrumb"),u=_("Button"),U=_("InputText"),Y=_("Dropdown"),v=_("Calendar"),b=_("Textarea"),f=_("TabPanel"),C=_("QuestionsList"),h=_("TabView"),S=_("Card"),M=_("ConfirmPopup");return T(),A("div",Ta,[c(t,{home:e.home,model:e.items,class:"mb-3 mt-0 pt-0"},null,8,["home","model"]),c(S,null,{content:y(()=>[i("div",ba,[xa,e.tmp_campaign.id&&e.tmp_campaign.status!="finished"?(T(),A("div",Na,[c(u,{label:"INVIA RECALL",class:"p-button-outlined p-button-warning mr-3",onClick:l[0]||(l[0]=s=>e.confirmSendRecall(s))}),c(u,{label:"INVIA CREDENZIALI",class:"p-button-outlined p-button-danger",onClick:l[1]||(l[1]=s=>e.confirmSendQuestionnaire(s))})])):w("",!0)]),c(h,null,{default:y(()=>[c(f,{header:"Dati campagna"},{default:y(()=>[i("div",wa,[i("div",Da,[Sa,c(U,{id:"name",type:"text",modelValue:e.tmp_campaign.name,"onUpdate:modelValue":l[2]||(l[2]=s=>e.tmp_campaign.name=s),class:V(["w-full",{"p-invalid":e.invalid_name}]),onChange:e.validateName},null,8,["modelValue","class","onChange"]),e.invalid_name?(T(),A("small",Ia,"Campo obbligatorio.")):w("",!0)]),i("div",ya,[Va,c(Y,{modelValue:e.tmp_campaign.audience_id,"onUpdate:modelValue":l[3]||(l[3]=s=>e.tmp_campaign.audience_id=s),options:e.response_audiences.audiences,optionLabel:"name",optionValue:"id",id:"audience",class:V(["w-full",{"p-invalid":e.invalid_audience}]),onChange:e.validateAudience},null,8,["modelValue","options","class","onChange"]),e.invalid_audience?(T(),A("small",Ra,"Campo obbligatorio.")):w("",!0)]),Ua,i("div",Ya,[i("div",Ma,[La,c(v,{inputId:"dateformat",modelValue:e.tmp_campaign.start_at,"onUpdate:modelValue":l[4]||(l[4]=s=>e.tmp_campaign.start_at=s),dateFormat:"dd/mm/yy",manualInput:!1,placeholder:"gg/mm/aaaa",id:"start_at",class:V({"p-invalid":e.invalid_start_at}),onChange:e.validateStartAt},null,8,["modelValue","class","onChange"]),e.invalid_start_at?(T(),A("small",ka,"Campo obbligatorio.")):w("",!0)]),i("div",Pa,[Ga,c(v,{inputId:"dateformat",modelValue:e.tmp_campaign.end_at,"onUpdate:modelValue":l[5]||(l[5]=s=>e.tmp_campaign.end_at=s),dateFormat:"dd/mm/yy",manualInput:!1,placeholder:"gg/mm/aaaa",id:"end_at",class:V({"p-invalid":e.invalid_end_at}),onChange:e.validateEndAt},null,8,["modelValue","class","onChange"]),e.invalid_end_at?(T(),A("small",Fa,"Campo obbligatorio.")):w("",!0)])]),i("div",Qa,[i("div",qa,[Oa,c(b,{id:"note",modelValue:e.tmp_campaign.intro_text_it,"onUpdate:modelValue":l[6]||(l[6]=s=>e.tmp_campaign.intro_text_it=s),rows:"5",cols:"30",class:"w-full"},null,8,["modelValue"])]),i("div",Ba,[za,c(b,{id:"note",modelValue:e.tmp_campaign.welcome_email_text_it,"onUpdate:modelValue":l[7]||(l[7]=s=>e.tmp_campaign.welcome_email_text_it=s),rows:"5",cols:"30",class:"w-full"},null,8,["modelValue"])]),i("div",Ha,[ja,c(b,{id:"note",modelValue:e.tmp_campaign.finish_email_text_it,"onUpdate:modelValue":l[8]||(l[8]=s=>e.tmp_campaign.finish_email_text_it=s),rows:"5",cols:"30",class:"w-full"},null,8,["modelValue"])])])])]),_:1}),c(f,{header:"Domande",disabled:!e.tmp_campaign.id},{default:y(()=>[c(C,{questions:e.campaign_questions},null,8,["questions"])]),_:1},8,["disabled"])]),_:1}),i("div",Za,[c(u,{label:"Salva",onClick:e.saveCampaign},null,8,["onClick"])])]),_:1}),c(M)])}const ae=ha(Aa,[["render",Ja]]);export{ae as default};
