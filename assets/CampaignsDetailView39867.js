import{g as pe,u as J,i as K,h as Z,k as _,c as V,B as fe,l as R,m as x,D as ve,C as W,s as M,_ as X,a as y,d as l,e as E,q as L,t as ge,b as s,w as k,E as Ce,r as m,o as g,j as he,G as be,p as j,I as xe,J as Ee,U as ye,Q as Ae,K as Te,L as we,M as Ne,N as De,n as Y,x as G,f as H}from"../index39867.js";import{Q as Se}from"./QuestionsList39867.js";import{s as P,h as v}from"./loader39867.js";const Ie={props:["campaign_detail"],setup(A){pe(()=>{u.value=A.campaign_detail?A.campaign_detail.users_count:0});const n=J(),D=K(),e=Z(),o=_(!1),r=_(),t=_(!1),u=_(),S=V(()=>n.getters[W.USER_COUNTER]),p=()=>{o.value=!0,D.require({group:"generate-users",header:"Genera utenze",message:"",icon:"",acceptIcon:"pi pi-check",rejectIcon:"pi pi-times"})},T=async function(){const f={counter:+r.value,campaign_id:A.campaign_detail.id};await n.dispatch(R.GENERATE_USER_QUESTIONNAIRES,f).then(C=>{o.value=!1,r.value="",t.value=!1}).catch(C=>{x(e,C),t.value=!1})},w=function(){o.value=!1,r.value=""},h=function(){t.value=!0,T()},b=async function(){let f=`/campaigns/${A.campaign_detail.id}/download_excel_user_questionnaires`;P(n);try{const N=await ve({method:"get",url:f,responseType:"blob",timeout:6e4});var C=new Blob([N.data],{type:N.headers["content-type"]});const I=document.createElement("a");I.href=window.URL.createObjectURL(C),I.download=`campagna_${A.campaign_detail.name.replace(/\s/g,"_").toLocaleLowerCase()}.xlsx`,I.click(),v(n)}catch(N){v(n),x(e,N)}};return fe(S,f=>{let C=f.counter+" utenze create con successo";f.counter==1&&(C="Un utenza creata con successo"),M(e,{message:C,title:""}),u.value=f.users_count}),{showDialog:o,genereteUsers:T,onGenereteUsers:p,counter:r,disableBtn:t,users_count:u,closeDialog:w,onConfirmDialog:h,downloadExcel:b}}};const Ue={class:"px-3 mb-6 pb-6 flex align-items-center justify-content-between"},Ve={key:0},Re={key:1},ke=l("b",null,"1",-1),Me={key:2},Le={class:"w-full"},Ye={class:"field col-8"},Ge=l("label",{for:"counter"},"Quante utenze vuoi generare?",-1),Pe={class:"flex align-items-center justify-content-end col-12 mt-5"};function Oe(A,n,D,e,o,r){const t=m("Button"),u=m("InputText"),S=m("ConfirmDialog");return g(),y(Ce,null,[l("div",Ue,[l("div",null,[e.users_count==0?(g(),y("p",Ve,"Non \xE8 stata generata nessuna utenza.")):E("",!0),e.users_count==1?(g(),y("p",Re,[L("E' stata generata "),ke,L(" utenza")])):E("",!0),e.users_count>1?(g(),y("p",Me,[L(" Sono state generate "),l("b",null,ge(e.users_count),1),L(" utenze ")])):E("",!0)]),l("div",null,[s(t,{label:"Genera utenze",class:"p-button-outlined ml-3",onClick:n[0]||(n[0]=p=>e.onGenereteUsers())}),s(t,{label:"Scarica Excel",class:"p-button-outlined ml-3",disabled:e.users_count==0,onClick:n[1]||(n[1]=p=>e.downloadExcel())},null,8,["disabled"])])]),s(S,{group:"generate-users",visible:e.showDialog,class:"generate-users"},{message:k(()=>[l("div",Le,[l("div",Ye,[Ge,s(u,{id:"counter",type:"number",modelValue:e.counter,"onUpdate:modelValue":n[2]||(n[2]=p=>e.counter=p),class:"w-full",min:"1"},null,8,["modelValue"])]),l("div",Pe,[s(t,{label:"Annulla",class:"mr-3 p-button-text",onClick:n[3]||(n[3]=p=>e.closeDialog())}),s(t,{label:"Conferma",class:"",onClick:n[4]||(n[4]=p=>e.onConfirmDialog()),disabled:!e.counter||e.counter<1||e.disableBtn},null,8,["disabled"])])])]),_:1},8,["visible"])],64)}const Fe=X(Ie,[["render",Oe]]),qe={setup(){const A=_({icon:"pi pi-home",to:"/campagne"}),n=_(""),D=_([{label:""}]),e=he(),o=J(),r=Z(),t=_({}),u=_({}),S="6d503a06-958b-4f83-af8d-92e39ced2f74",p=_(File),T=_(!1),w=_(!1),h=_(!1),b=_(!1),f=K(),C=V(()=>o.getters[xe.CURRENT_COMPANIES]),N=V(()=>o.getters[Ee.CURRENT_AUDIENCES]),I=V(()=>o.getters[ye.CURRENT_USERS]),d=V(()=>o.getters[W.CURRENT_CAMPAIGN]),c=V(()=>o.getters[Ae.CURRENT_QUESTIONS]),$=async function(){try{return await o.dispatch(Te.FETCH_ALL_COMPANIES)}catch(a){v(o),x(r,a)}},ee=async function(){try{return await o.dispatch(we.FETCH_ALL_AUDIENCES)}catch(a){v(o),x(r,a)}},ae=async function(){const a=new Map;a.set("roles","admin");try{return await o.dispatch(Ne.FETCH_ALL_USERS,a)}catch(i){v(o),x(r,i)}},te=async function(){try{return await o.dispatch(De.FETCH_ALL_CAMPAIGN_QUESTIONS,e.params.id+"")}catch{v(o)}},O=async function(){P(o);try{const a=await o.dispatch(R.FETCH_CAMPAIGN_DETAIL,e.params.id+"");return le(),v(o),a}catch(a){v(o),x(r,a)}},F=function(){const a=new FormData;u.value&&u.value.name&&a.append("campaign[logo]",u.value);let i=t.value.start_at!==""?Y(t.value.start_at,"DD/MM/YYYY").format("YYYY-MM-DD"):"",_e=t.value.end_at!==""?Y(t.value.end_at,"DD/MM/YYYY").format("YYYY-MM-DD"):"";for(const U in t.value)U=="start_at"?a.append(`campaign[${U}]`,i):U=="end_at"?a.append(`campaign[${U}]`,_e):a.append(`campaign[${U}]`,t.value[U]+"");return delete t.value.logo_url,a},ne=async function(){P(o);const a={campaign_id:t.value.id,formData:F()};try{const i=await o.dispatch(R.UPDATE_CAMPAIGN,a);return M(r,{message:"Campagna aggiornata correttamente.",title:""}),O(),j.replace({name:"campagne"}),v(o),i}catch(i){v(o),x(r,i)}},oe=async function(){P(o);const a={formData:F()};a.formData.append("campaign[template_questionnaire_id]",S);try{const i=await o.dispatch(R.CREATE_CAMPAIGN,a);return M(r,{message:"Campagna creata correttamente.",title:""}),j.replace({name:"campagne"}),v(o),i}catch(i){v(o),x(r,i)}},le=function(){var a;t.value.id=d.value.id,t.value.name=d.value.name,t.value.start_at=Y.unix(d.value.start_at).format("DD/MM/YYYY"),t.value.end_at=Y.unix(d.value.end_at).format("DD/MM/YYYY"),t.value.audience_id=d.value.audience_id,t.value.finish_email_text_it=d.value.finish_email_text_it!=null?d.value.finish_email_text_it:"",t.value.intro_text_it=d.value.intro_text_it!=null?d.value.intro_text_it:"",t.value.welcome_email_text_it=d.value.welcome_email_text_it!=null?d.value.welcome_email_text_it:"",t.value.logo_url=d.value.logo_url,t.value.status=d.value.status,t.value.excel=d.value.excel,t.value.company_id=(a=d.value.company)==null?void 0:a.id},se=function(){B()||q()||z()||Q()||(n.value!=""&&t.value.id?ne():oe())},q=function(){var a,i;return((a=t.value)==null?void 0:a.start_at)==""||((i=t.value)==null?void 0:i.start_at)==null?h.value=!0:h.value=!1,h.value},z=function(){var a,i;return((a=t.value)==null?void 0:a.end_at)==""||((i=t.value)==null?void 0:i.end_at)==null?b.value=!0:b.value=!1,b.value},B=function(){var a,i;return((a=t.value)==null?void 0:a.name)==""||((i=t.value)==null?void 0:i.name)==null?T.value=!0:T.value=!1,T.value},Q=function(){var a,i;return t.value.excel&&(((a=t.value)==null?void 0:a.company_id)==""||((i=t.value)==null?void 0:i.company_id)==null)?w.value=!0:w.value=!1,w.value},ie=a=>{t.value.logo_url="",u.value=a.files[0]},ce=a=>{f.require({target:a.currentTarget,message:"Sei sicuro di voler mandare un recall agli utenti che non hanno ancora compilato il questionario?",icon:"pi pi-info-circle",acceptClass:"p-button-warning",accept:()=>{me()}})},re=a=>{f.require({target:a.currentTarget,message:"Sei sicuro di voler inviare le credenziali?",icon:"pi pi-info-circle",acceptClass:"p-button-danger",accept:()=>{de()}})},de=async function(){await o.dispatch(R.SEND_CREDENTIALS,t.value.id).then(()=>{M(r,{message:"Credenziali inviate correttamente.",title:""})}).catch(a=>{x(r,a)})},me=async function(){await o.dispatch(R.SEND_RECALL,t.value.id).then(()=>{M(r,{message:"Recall inviato correttamente.",title:""})}).catch(a=>{x(r,a)})},ue=function(a){a||(t.value.company_id="")};return be(async()=>{$(),ee(),ae(),n.value=e.params.id+"",n.value!=""?(O(),te(),D.value[0]={label:"Modifica campagna"}):D.value[0]={label:"Nuova campagna"}}),{campaign_detail:d,home:A,items:D,response_companies:C,response_audiences:N,users:I,tmp_campaign:t,invalid_name:T,invalid_company:w,invalid_start_at:h,invalid_end_at:b,uploadedFile:u,file:p,campaign_questions:c,saveCampaign:se,validateStartAt:q,validateEndAt:z,validateName:B,confirmSendQuestionnaire:re,onSelectedFiles:ie,confirmSendRecall:ce,validateCompany:Q,onExcelValueChanged:ue}},components:{QuestionsList:Se,GeneratesUsersTab:Fe}};const ze={class:"m-4"},Be={class:"flex align-items-center justify-content-between"},Qe=l("h1",null,"CAMPAGNA",-1),je={key:0},He={class:"formgrid grid col-10"},Je={class:"field col-6"},Ke=l("label",{for:"name"},"Nome campagna*",-1),Ze={key:0,id:"name",class:"p-error"},We={class:"field col-6"},Xe=l("label",{for:"company"},"Azienda*",-1),$e={key:0,id:"company",class:"p-error"},ea={class:"field col-6"},aa=l("label",{for:"audience"},"Audience*",-1),ta={class:"flex align-items-center col-3 pl-3"},na=l("label",{for:"excel",class:"ml-2"},"Genera accessi in Excel ",-1),oa=l("div",{class:"field col-6"},null,-1),la={class:"my-0 col-12 flex flex-wrap mx-0"},sa={class:"field col-6 flex flex-column pl-0"},ia=l("label",{for:"start_at"},"Data inizio*",-1),ca={key:0,id:"end_at",class:"p-error"},ra={class:"field col-6 flex flex-column pr-0"},da=l("label",{for:"end_at"},"Data fine*",-1),ma={key:0,id:"end_at",class:"p-error"},ua={class:"my-0 col-12 flex flex-wrap mx-0"},_a={class:"field col-6 pl-0"},pa=l("label",{for:"note"},"Intro questionario",-1),fa={class:"field col-6 pl-0"},va=l("label",{for:"note"},"Intro email",-1),ga={class:"field col-6 pl-0"},Ca=l("label",{for:"note"},"Fine email",-1),ha={class:"flex justify-content-end"};function ba(A,n,D,e,o,r){const t=m("Breadcrumb"),u=m("Button"),S=m("InputText"),p=m("Dropdown"),T=m("Checkbox"),w=m("Calendar"),h=m("Textarea"),b=m("TabPanel"),f=m("QuestionsList"),C=m("GeneratesUsersTab"),N=m("TabView"),I=m("Card"),d=m("ConfirmPopup");return g(),y("div",ze,[s(t,{home:e.home,model:e.items,class:"mb-3 mt-0 pt-0"},null,8,["home","model"]),s(I,null,{content:k(()=>[l("div",Be,[Qe,e.tmp_campaign.id&&e.tmp_campaign.status!="finished"?(g(),y("div",je,[s(u,{label:"INVIA RECALL",class:"p-button-outlined p-button-warning mr-3",onClick:n[0]||(n[0]=c=>e.confirmSendRecall(c))}),s(u,{label:"INVIA CREDENZIALI",class:"p-button-outlined p-button-danger",onClick:n[1]||(n[1]=c=>e.confirmSendQuestionnaire(c))})])):E("",!0)]),s(N,null,{default:k(()=>[s(b,{header:"Dati campagna"},{default:k(()=>[l("div",He,[l("div",Je,[Ke,s(S,{id:"name",type:"text",modelValue:e.tmp_campaign.name,"onUpdate:modelValue":n[2]||(n[2]=c=>e.tmp_campaign.name=c),class:G(["w-full",{"p-invalid":e.invalid_name}]),onChange:e.validateName},null,8,["modelValue","class","onChange"]),e.invalid_name?(g(),y("small",Ze,"Campo obbligatorio.")):E("",!0)]),l("div",We,[Xe,s(p,{modelValue:e.tmp_campaign.company_id,"onUpdate:modelValue":n[3]||(n[3]=c=>e.tmp_campaign.company_id=c),options:e.response_companies.companies,optionLabel:"name",optionValue:"id",id:"company",class:G(["w-full",{"p-invalid":e.invalid_company}]),onChange:e.validateCompany,disabled:!e.tmp_campaign.excel},null,8,["modelValue","options","class","onChange","disabled"]),e.invalid_company?(g(),y("small",$e,"Campo obbligatorio.")):E("",!0)]),l("div",ea,[aa,s(p,{modelValue:e.tmp_campaign.audience_id,"onUpdate:modelValue":n[4]||(n[4]=c=>e.tmp_campaign.audience_id=c),options:e.response_audiences.audiences,optionLabel:"name",optionValue:"id",id:"audience",class:"w-full",disabled:e.tmp_campaign.excel},null,8,["modelValue","options","disabled"])]),l("div",ta,[s(T,{modelValue:e.tmp_campaign.excel,"onUpdate:modelValue":[n[5]||(n[5]=c=>e.tmp_campaign.excel=c),e.onExcelValueChanged],inputId:"excel",binary:!0},null,8,["modelValue","onUpdate:modelValue"]),na]),oa,l("div",la,[l("div",sa,[ia,s(w,{inputId:"dateformat",modelValue:e.tmp_campaign.start_at,"onUpdate:modelValue":n[6]||(n[6]=c=>e.tmp_campaign.start_at=c),dateFormat:"dd/mm/yy",manualInput:!1,placeholder:"gg/mm/aaaa",id:"start_at",class:G({"p-invalid":e.invalid_start_at}),onChange:e.validateStartAt},null,8,["modelValue","class","onChange"]),e.invalid_start_at?(g(),y("small",ca,"Campo obbligatorio.")):E("",!0)]),l("div",ra,[da,s(w,{inputId:"dateformat",modelValue:e.tmp_campaign.end_at,"onUpdate:modelValue":n[7]||(n[7]=c=>e.tmp_campaign.end_at=c),dateFormat:"dd/mm/yy",manualInput:!1,placeholder:"gg/mm/aaaa",id:"end_at",class:G({"p-invalid":e.invalid_end_at}),onChange:e.validateEndAt},null,8,["modelValue","class","onChange"]),e.invalid_end_at?(g(),y("small",ma,"Campo obbligatorio.")):E("",!0)])]),l("div",ua,[l("div",_a,[pa,s(h,{id:"note",modelValue:e.tmp_campaign.intro_text_it,"onUpdate:modelValue":n[8]||(n[8]=c=>e.tmp_campaign.intro_text_it=c),rows:"5",cols:"30",class:"w-full"},null,8,["modelValue"])]),l("div",fa,[va,s(h,{id:"note",modelValue:e.tmp_campaign.welcome_email_text_it,"onUpdate:modelValue":n[9]||(n[9]=c=>e.tmp_campaign.welcome_email_text_it=c),rows:"5",cols:"30",class:"w-full"},null,8,["modelValue"])]),l("div",ga,[Ca,s(h,{id:"note",modelValue:e.tmp_campaign.finish_email_text_it,"onUpdate:modelValue":n[10]||(n[10]=c=>e.tmp_campaign.finish_email_text_it=c),rows:"5",cols:"30",class:"w-full"},null,8,["modelValue"])])])])]),_:1}),s(b,{header:"Domande",disabled:!e.tmp_campaign.id},{default:k(()=>[s(f,{questions:e.campaign_questions},null,8,["questions"])]),_:1},8,["disabled"]),e.tmp_campaign.excel?(g(),H(b,{key:0,header:"Genera utenze",disabled:!e.tmp_campaign.id},{default:k(()=>[e.campaign_detail.id?(g(),H(C,{key:0,campaign_detail:e.campaign_detail},null,8,["campaign_detail"])):E("",!0)]),_:1},8,["disabled"])):E("",!0)]),_:1}),l("div",ha,[s(u,{label:"Salva",onClick:e.saveCampaign},null,8,["onClick"])])]),_:1}),s(d)])}const Aa=X(qe,[["render",ba]]);export{Aa as default};
