import{g as B,F as L,u as P,h as K,i as U,k as _,c as M,R as C,m as w,n as x,s as S,V as O,_ as N,a as R,b as s,w as f,r as u,o as h,p as k,q as z,t as F,K as I,J as Y,x as E,y as q,d as D,e as A}from"../index70335.js";import{h as H}from"./moment70335.js";import{h as J}from"./loader70335.js";const $={setup(){B(()=>{v.value=!0,t.value={first:0,rows:a.value.rows,sortField:null,sortOrder:null,filters:d.value};const e=localStorage.getItem("dt-templates");if(t.value.page==null&&e){let n=JSON.parse(e);t.value.first=n.first,t.value.page=n.first/t.value.rows}L.register("filter_report",(n,V)=>n===V),i()});const l=P(),r=K(),y=U(),a=_(),d=_({title:{value:"",matchMode:"contains"}}),v=_(!0),t=_(),p=_(0),m=_([{label:"My Filter",value:"filter_report"}]),b=M(()=>l.getters[O.CURRENT_REPORTS]);function i(){v.value=!0;const e=new Map;e.set("title",d.value.title?d.value.title.value:""),e.set("page",t.value.page+1),e.set("per_page",t.value.rows),t.value.sortField&&(t.value.sortOrder==1?e.set("sorted_by",t.value.sortField+"_asc"):e.set("sorted_by",t.value.sortField+"_desc")),setTimeout(()=>{g(e)},Math.random()*1e3+250)}const g=async function(e){try{const n=await l.dispatch(C.FETCH_ALL_REPORTS,e);return v.value=!1,n}catch(n){J(l),w(r,n)}},o=async function(e){await l.dispatch(C.DELETE_REPORT,e).then(()=>{S(r,{message:"Report eliminato correttamente.",title:""}),i()}).catch(n=>{w(r,n)})};return{dt:a,response:b,loading:v,filters1:d,totalRecords:p,lazyParams:t,loadLazyData:i,matchModes:m,goToReport:function(e){x.push({name:"dettaglio-report",params:{id:e}})},onPage:e=>{t.value=e,i()},onSort:e=>{t.value=e,i()},onFilter:()=>{t.value.page=0,t.value.filters=d.value,i()},confirmDeleteTemplate:(e,n)=>{y.require({target:e.currentTarget,message:"Sei sicuro di voler eliminare questo report?",icon:"pi pi-info-circle",acceptClass:"p-button-danger",accept:()=>{o(n)}})},toggleEdit:function(e){x.push({name:"dettaglio-report",params:{id:e.id}})},reloadReport:async function(e){await l.dispatch(C.REFRESH_REPORT,e).then(()=>{S(r,{message:"Report aggiornato correttamente.",title:""}),i()}).catch(n=>{w(r,n)})},moment:H}}};function j(l,r,y,a,d,v){const t=u("InputText"),p=u("Column"),m=u("Button"),b=u("DataTable"),i=u("ConfirmPopup"),g=q("tooltip");return h(),R("div",null,[s(b,{value:a.response.reports,totalRecords:a.response.total,lazy:!0,paginator:!0,rows:30,filters:a.filters1,"onUpdate:filters":r[0]||(r[0]=o=>a.filters1=o),ref:"dt",dataKey:"id",loading:a.loading,onPage:r[1]||(r[1]=o=>a.onPage(o)),onSort:r[2]||(r[2]=o=>a.onSort(o)),onFilter:r[3]||(r[3]=o=>a.onFilter()),filterDisplay:"row",removableSort:""},{empty:f(()=>[k(" Nessun report trovato. ")]),default:f(()=>[s(p,{field:"title",header:"Nome",filterMatchMode:"contains",ref:"title",sortable:!0,showFilterMatchModes:!1,showFilterOperator:!1,showFilterMenu:!1},{filter:f(({filterModel:o,filterCallback:c})=>[s(t,{type:"text",modelValue:o.value,"onUpdate:modelValue":T=>o.value=T,onKeydown:z(T=>c(),["enter"]),class:"p-column-filter",placeholder:"Filtra per report"},null,8,["modelValue","onUpdate:modelValue","onKeydown"])]),_:1},512),s(p,{field:"created_at",header:"Data creazione",sortable:!1},{body:f(({data:o})=>[k(F(a.moment.unix(o.created_at).format("DD/MM/YYYY")),1)]),_:1}),s(p,{field:"campaign",header:"Campagne",sortable:!1},{body:f(({data:o})=>[(h(!0),R(I,null,Y(o.campaigns,c=>(h(),R("p",{key:c.id,class:"m-0"},F(c.name),1))),128))]),_:1}),s(p,{header:"",style:{width:"14rem"}},{body:f(({data:o})=>[E(s(m,{type:"button",onClick:c=>a.goToReport(o.id),"aria-haspopup":"true","aria-controls":"overlay_menu",class:"p-button-text p-button-rounded text-300 surface-200 mr-3",icon:"pi pi-chart-bar",disabled:!o.ready},null,8,["onClick","disabled"]),[[g,"Report",void 0,{top:!0}]]),E(s(m,{type:"button",onClick:c=>a.reloadReport(o.id),"aria-haspopup":"true","aria-controls":"overlay_menu",class:"p-button-text p-button-rounded text-300 surface-200 mr-3",icon:"pi pi-refresh"},null,8,["onClick"]),[[g,"Ricarica report",void 0,{top:!0}]]),E(s(m,{type:"button",onClick:c=>a.confirmDeleteTemplate(c,o.id),"aria-haspopup":"true","aria-controls":"overlay_menu",class:"p-button-text p-button-rounded text-300 surface-200",icon:"pi pi-trash"},null,8,["onClick"]),[[g,"Elimina",void 0,{top:!0}]])]),_:1})]),_:1},8,["value","totalRecords","filters","loading"]),s(i)])}const G=N($,[["render",j]]),Q={setup(){const l=P();return{reports:M(()=>l.getters[O.CURRENT_REPORTS])}},components:{ReportsTable:G}},W={class:"flex justify-content-between align-items-center"},X={key:0,class:"uppercase"};function Z(l,r,y,a,d,v){const t=u("Button"),p=u("ReportsTable"),m=u("Card");return h(),R("div",null,[s(m,null,{content:f(()=>[D("div",W,[a.reports?(h(),R("h1",X,[D("span",null,F(a.reports.total)+" Report",1)])):A("",!0),s(t,{class:"",label:"Nuovo report",onClick:r[0]||(r[0]=b=>l.$router.push("/nuovo-report"))})]),s(p)]),_:1})])}const ie=N(Q,[["render",Z]]);export{ie as default};
