import{V as Y,u as Z,h as J,c as B,j as K,k as y,G as ee,W as te,X as z,Y as se,m as O,D as oe,Z as q,_ as ae,a as c,b as p,d as t,w as R,t as v,E as I,N as L,e as h,r as E,o as i,f as S,y as V,$ as ne,a0 as ie,q as T,z as re}from"../index92302.js";import{h as F,s as le}from"./loader92302.js";const ce=function(e){return e.params.id!==void 0?e.params.id:""},de=Y({name:"ReportView",setup(){const e=Z(),d=J(),n=B(()=>e.getters[q.CURRENT_REPORT]),M=B(()=>e.getters[q.CURRENT_REPORT_CREATED_AT]),P=B(()=>e.getters["auth/isUserSuperAdmin"]),U=B(()=>e.getters["auth/isUserAdmin"]),x=K(),C=y({icon:"pi pi-home",to:"/campagne"}),f=y([{label:"Report"}]),A=["Carichi di cura","Economico - Finanziarie","Salute e benessere","Mobilit\xE0 e trasporto","Formazione","Tempo libero"],_=y(),g=y(),D=y(),$=B(()=>({chartData:{datasets:[{data:n.value!=null?n.value.sections:[],backgroundColor:["#cd1867","#DB4CB3","#EABB3D","#B958D8","#a1c653","#009265"]}],labels:A},chartOptions:{maintainAspectRatio:.5,plugins:{legend:{display:!1},tooltip:{callbacks:{label:s=>`${s.formattedValue}`}}},scales:{y:{ticks:{display:!1}}}}})),o=y(),b=y([{label:"Et\xE0",code:"age",items:[{label:"18-34",value:"filter_age_18"},{label:"35-54",value:"filter_age_35"},{label:"55-64",value:"filter_age_55"},{label:"65+",value:"filter_age_65"}]},{label:"Genere",code:"genre",items:[{label:"Maschio",value:"filter_gender_m"},{label:"Femmina",value:"filter_gender_f"},{label:"Altro/Preferisco non rispondere",value:"filter_gender_a"}]}]),W=async function(s){try{const a=await e.dispatch(z.FETCH_REPORT_DETAIL,s);return H(),N(),a}catch(a){F(e),O(d,a)}},j=async function(){g.value=ce(x);const s=new Map;if(o.value&&s.set("filter",o.value),s.set("report_id",g.value),g.value!="")if(x.name=="dettaglio-report")C.value={icon:"pi pi-home",to:"/reports"},W(s);else try{const a=await e.dispatch(z.SHOW,s);return H(),N(),a}catch(a){F(e),O(d,a)}},N=()=>{D.value=[],n.value.answers[0].forEach(s=>{D.value.push(Q(s))})},Q=s=>{const a=[],l=[];if(n.value!=null)return s.answers.forEach(r=>{a.push(r.total),l.push(r.showrt_answer_label)}),{chartData:{datasets:[{data:a,backgroundColor:["#6EF0D2","#DB4CB3","#EABB3D","#F0A68F"]}],labels:l},chartOptions:{indexAxis:"y",maintainAspectRatio:.5,plugins:{title:{display:!1,text:`${s.question_label} - Rispondenti: ${s.answer_count} su ${n.value.completed}`},legend:{display:!1},tooltip:{callbacks:{label:r=>"",title:r=>[`${a[r[0].dataIndex]} risposte`,`${Math.round(a[r[0].dataIndex]*100/s.answer_count)}% del campione`,`${Math.round(a[r[0].dataIndex]*100/n.value.completed)}% del totale`]}}}},question:`${s.question_label} - Rispondenti: ${s.answer_count} su ${n.value.completed} `}},G=(s,a)=>{const l=[],r=[],w=[];if(n.value!=null)return s.answers.forEach(m=>{l.push(m.total),w.push(m.showrt_answer_label),r.push(m.answer_label),s.answer_count*100/n.value.completed}),{chartData:{datasets:[{data:l,backgroundColor:a}],labels:w},chartOptions:{maintainAspectRatio:.5,plugins:{title:{display:!0},legend:{display:!1},tooltip:{callbacks:{label:m=>"",title:m=>[`${r[m[0].dataIndex]}`,`${l[m[0].dataIndex]} risposte`,`${Math.round(l[m[0].dataIndex]*100/s.answer_count)}% del campione`,`${Math.round(l[m[0].dataIndex]*100/n.value.completed)}% del totale`]}}}},question:`${s.question_label} <br> Rispondenti: ${s.answer_count} su ${n.value.completed} `}},H=()=>{if(_.value=[],A.forEach((s,a)=>{let l={title:s,content:[]};_.value.push(l)}),n.value.answers)for(let s in n.value.answers)switch(+s){case 1:{k(s,"#cd1867",0);break}case 2:k(s,"#DB4CB3",1);break;case 3:k(s,"#EABB3D",2);break;case 4:k(s,"#B958D8",3);break;case 5:k(s,"#a1c653",4);break;case 6:k(s,"#009265",5);break}},k=(s,a,l)=>{n.value.answers[s].forEach(r=>{_.value[l].content.push(G(r,a))})},X=async function(s){let a="";s?a=`/reports/${g.value}/download_report`:a=`/campaigns/${g.value}/download_report`,le(e);try{const r=await oe({method:"get",url:a,responseType:"blob",timeout:6e4});var l=new Blob([r.data],{type:r.headers["content-type"]});const w=document.createElement("a");w.href=window.URL.createObjectURL(l),s?w.download=`report_${n.value.report_title.replace(/\s/g,"_").toLocaleLowerCase()}.xlsx`:w.download=`report_${n.value.campaign_name.replace(/\s/g,"_").toLocaleLowerCase()}.xlsx`,w.click(),F(e)}catch(r){F(e),O(d,r)}};return ee(async()=>{j()}),te(()=>{e.dispatch(z.RESET_REPORT)}),{home:C,items:f,chartSections:$,genericChartData:G,chartsTab0:D,report:n,tabs:_,groupedFilters:b,selectedGroupedFilter:o,route:x,report_create_at:M,downloadReport:X,userIsSuperAdmin:P,isUserAdmin:U,initReport:j,isButtonReportDisabled:se}}}),pe="/assets/user92302.svg",ue="/assets/thumbs-up92302.svg",_e="/assets/hourglass92302.svg",me="/assets/thumbs-down92302.svg";const u=e=>(ne("data-v-fc14dcb9"),e=e(),ie(),e),he={class:"dashboard"},be={class:"mb-3"},ve={class:"container"},fe={class:"col-12 flex align-items-center justify-content-between pb-0"},ge={class:"flex"},we=u(()=>t("h3",{class:"text-white m-0 mr-3"},"Questionario",-1)),ye={key:0,class:"text-white mt-0"},Re={key:1,class:"text-white mt-0"},Ee={key:0,class:"col-12 flex align-items-center"},ke=u(()=>t("h3",{class:"text-white m-0 mr-3"},"Inizio",-1)),Te={class:"text-white mt-0"},xe={key:1,class:"col-12 flex align-items-center"},Ce=u(()=>t("h3",{class:"text-white m-0 mr-3"},"Scadenza",-1)),De={class:"text-white mt-0"},$e={key:0,class:"grid justify-content-center align-items-end flex-wrap border-round-sm"},Be={class:"col-12"},Ae={class:"container"},Ie=u(()=>t("h3",null,"Fruizione questionario",-1)),Le={class:"flex align-items-center justify-content-between flex-wrap"},Se={class:"counter-block border-round-2xl p-3"},Fe={class:"text-white m-0"},ze=u(()=>t("div",{class:"flex align-items-center justify-content-between"},[T(" Iscritti "),t("img",{src:pe,class:"h-2rem"})],-1)),Oe={class:"counter-block border-round-2xl p-3"},Ve={class:"text-white m-0"},Me=u(()=>t("div",{class:"flex align-items-center justify-content-between"},[T(" Concluso "),t("img",{src:ue,class:"h-2rem"})],-1)),Pe={class:"counter-block border-round-2xl p-3"},Ue={class:"text-white m-0"},je=u(()=>t("div",{class:"flex align-items-center justify-content-between"},[T(" Iniziato "),t("img",{src:_e,class:"h-2rem"})],-1)),Ne={class:"counter-block border-round-2xl p-3"},Ge={class:"text-white m-0"},He=u(()=>t("div",{class:"flex align-items-center justify-content-between"},[T(" Non iniziato "),t("img",{src:me,class:"h-2rem"})],-1)),qe={class:"col-12 pl-0 ml-0 mb-0"},We=u(()=>t("h3",{class:"mb-0"},"Risultati",-1)),Qe={class:"flex justify-content-end mt-0 mb-2"},Xe={class:"wrapper-charts"},Ye={class:"flex"},Ze={class:""},Je=u(()=>t("h3",{class:"mt-3"},"Bisogni",-1)),Ke=u(()=>t("p",{class:"mb-6 font-italic line-height-2"},[T(" I punteggi assegnati alle singole aree previste dal grafico indicano l\u2019intensit\xE0 di bisogno rilevata nella popolazione aziendale. Pi\xF9 alto il punteggio, maggiore l\u2019intensit\xE0 di bisogno rilevata nella specifica area."),t("br"),T(" Si noti bene che il punteggio non si riferisce ad una porzione percentuale della popolazione aziendale. ")],-1)),et={key:0,class:"flex row-gap-3 flex-column"},tt={class:"text-center font-semibold"},st=["innerHTML"],ot={class:"pi pi-info-circle cursor-pointer"},at={key:0,class:"flex flex-wrap"},nt={class:"text-center font-semibold"},it=["innerHTML"],rt={class:"pi pi-info-circle cursor-pointer"},lt={class:"text-center font-semibold"},ct=["innerHTML"],dt={class:"pi pi-info-circle cursor-pointer"};function pt(e,d,n,M,P,U){const x=E("Breadcrumb"),C=E("Button"),f=E("Card"),A=E("Dropdown"),_=E("Chart"),g=E("TabPanel"),D=E("TabView"),$=re("tooltip");return i(),c("div",he,[p(x,{home:e.home,model:e.items,class:"mb-3 mt-0 pt-0"},null,8,["home","model"]),t("div",be,[p(f,{class:"box py-2"},{content:R(()=>{var o;return[t("div",ve,[t("div",fe,[t("div",ge,[we,e.report&&e.report.campaign_name?(i(),c("span",ye,v(e.report.campaign_name),1)):h("",!0),e.report&&e.report.report_title?(i(),c("span",Re,v(e.report.report_title),1)):h("",!0)]),(e.isUserAdmin||e.userIsSuperAdmin)&&e.route.name!="dettaglio-report"?(i(),S(C,{key:0,class:"p-button-outlined p-button-secondary",label:"Scarica Report",onClick:d[0]||(d[0]=b=>e.downloadReport(!1)),disabled:e.isButtonReportDisabled((o=e.report)==null?void 0:o.campaign_start_at)},null,8,["disabled"])):h("",!0),(e.isUserAdmin||e.userIsSuperAdmin)&&e.route.name=="dettaglio-report"?(i(),S(C,{key:1,class:"p-button-outlined p-button-secondary",label:"Scarica Report",onClick:d[1]||(d[1]=b=>e.downloadReport(!0)),disabled:e.isButtonReportDisabled(e.report_create_at)},null,8,["disabled"])):h("",!0)]),e.report&&e.report.campaign_start_at?(i(),c("div",Ee,[ke,t("span",Te,v(e.report.campaign_start_at),1)])):h("",!0),e.report&&e.report.campaign_end_at?(i(),c("div",xe,[Ce,t("span",De,v(e.report.campaign_end_at),1)])):h("",!0)])]}),_:1})]),e.report?(i(),c("div",$e,[t("div",Be,[t("div",Ae,[Ie,t("div",Le,[t("div",Se,[t("h2",Fe,v(e.report.total),1),ze]),t("div",Oe,[t("h2",Ve,v(e.report.completed),1),Me]),t("div",Pe,[t("h2",Ue,v(e.report.started),1),je]),t("div",Ne,[t("h2",Ge,v(e.report.total-e.report.completed-e.report.started),1),He])]),t("div",qe,[We,t("div",Qe,[p(A,{modelValue:e.selectedGroupedFilter,"onUpdate:modelValue":d[2]||(d[2]=o=>e.selectedGroupedFilter=o),options:e.groupedFilters,optionLabel:"label",optionValue:"value",optionGroupLabel:"label",optionGroupChildren:"items",placeholder:"Filtra per et\xE0 o genere",onChange:d[3]||(d[3]=o=>e.initReport()),showClear:!0},null,8,["modelValue","options"])])]),t("div",Xe,[t("div",Ye,[p(f,null,{content:R(()=>[t("div",Ze,[t("div",null,[Je,Ke,p(_,{type:"bar",data:e.chartSections.chartData,options:e.chartSections.chartOptions},null,8,["data","options"])])])]),_:1})]),e.chartsTab0?(i(),c("div",et,[(i(!0),c(I,null,L(e.chartsTab0.slice(0,2),o=>(i(),S(f,{key:o},{content:R(()=>[t("div",tt,[t("span",{innerHTML:o.question,class:"line-height-3"},null,8,st),V(t("i",ot,null,512),[[$,"Il questionario \xE8 adattivo e mostra le domande solo agli utenti in target. La domanda \xE8 stata posta ad un campione selezionato di utenti. Passando il mouse sul grafico \xE8 possibile accedere alle statistiche di approfondimento.",void 0,{top:!0}]])]),p(_,{type:"bar",data:o.chartData,options:o.chartOptions},null,8,["data","options"])]),_:2},1024))),128))])):h("",!0)]),e.chartsTab0?(i(),c("div",at,[(i(!0),c(I,null,L(e.chartsTab0.slice(2),o=>(i(),c("div",{class:"col-6",key:o},[p(f,null,{content:R(()=>[t("div",nt,[t("span",{innerHTML:o.question,class:"line-height-3"},null,8,it),V(t("i",rt,null,512),[[$,"Il questionario \xE8 adattivo e mostra le domande solo agli utenti in target. La domanda \xE8 stata posta ad un campione selezionato di utenti. Passando il mouse sul grafico \xE8 possibile accedere alle statistiche di approfondimento.",void 0,{top:!0}]])]),p(_,{type:"bar",data:o.chartData,options:o.chartOptions},null,8,["data","options"])]),_:2},1024)]))),128))])):h("",!0),p(f,{class:"mt-4"},{content:R(()=>[p(D,null,{default:R(()=>[(i(!0),c(I,null,L(e.tabs,o=>(i(),S(g,{key:o.title,header:o.title},{default:R(()=>[(i(!0),c(I,null,L(o.content,b=>(i(),c("div",{key:b,class:"my-4 xs:col-12 xs:col-offset-0 lg:col-8 lg:col-offset-2"},[t("div",lt,[t("span",{innerHTML:b.question,class:"line-height-3"},null,8,ct),V(t("i",dt,null,512),[[$,"Il questionario \xE8 adattivo e mostra le domande solo agli utenti in target. La domanda \xE8 stata posta ad un campione selezionato di utenti. Passando il mouse sul grafico \xE8 possibile accedere alle statistiche di approfondimento.",void 0,{top:!0}]])]),p(_,{type:"bar",data:b.chartData,options:b.chartOptions},null,8,["data","options"])]))),128))]),_:2},1032,["header"]))),128))]),_:1})]),_:1})])])])):h("",!0)])}const mt=ae(de,[["render",pt],["__scopeId","data-v-fc14dcb9"]]);export{mt as default};
