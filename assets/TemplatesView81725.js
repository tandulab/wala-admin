import{g as F,F as N,u as w,h as A,i as x,k as i,c as C,T as h,m as E,n as k,p as q,s as V,R as y,_ as M,a as v,b as u,w as d,r as p,o as g,q as S,t as R,d as b,e as z}from"../index81725.js";import{h as O}from"./loader81725.js";const Y={setup(){F(()=>{r.value=!0,e.value={first:0,rows:o.value.rows,sortField:null,sortOrder:null,filters:n.value};const t=localStorage.getItem("dt-templates");if(e.value.page==null&&t){let a=JSON.parse(t);e.value.first=a.first,e.value.page=a.first/e.value.rows}N.register("filter_template",(a,D)=>a===D),c()});const s=w(),l=A(),_=x(),o=i(),n=i({name:{value:"",matchMode:"contains"}}),r=i(!0),e=i(),m=i(0),f=i([{label:"My Filter",value:"filter_template"}]),T=C(()=>s.getters[y.CURRENT_TEMPLATES]);function c(){r.value=!0;const t=new Map;t.set("name",n.value.name?n.value.name.value:""),t.set("page",e.value.page+1),t.set("per_page",e.value.rows),e.value.sortField&&(e.value.sortOrder==1?t.set("sorted_by",e.value.sortField+"_asc"):t.set("sorted_by",e.value.sortField+"_desc")),setTimeout(()=>{L(t)},Math.random()*1e3+250)}const L=async function(t){try{const a=await s.dispatch(h.FETCH_ALL_TEMPLATES,t);return r.value=!1,a}catch(a){O(s),E(l,a)}},P=async function(t){await s.dispatch(h.DELETE_TEMPLATE,t).then(()=>{V(l,{message:"Template eliminato correttamente.",title:""}),c()}).catch(a=>{E(l,a)})};return{dt:o,response:T,filters:n,loading:r,totalRecords:m,lazyParams:e,loadLazyData:c,matchModes:f,onPage:t=>{e.value=t,c()},onSort:t=>{e.value=t,c()},onFilter:()=>{e.value.page=0,e.value.filters=n.value,c()},confirmDeleteTemplate:(t,a)=>{_.require({target:t.currentTarget,message:"Sei sicuro di voler eliminare questo template?",icon:"pi pi-info-circle",acceptClass:"p-button-danger",accept:()=>{P(a)}})},onRowSelect:function(t){q.push({name:"dettaglio-template",params:{id:t.data.id}})},moment:k}}};function $(s,l,_,o,n,r){const e=p("Column"),m=p("DataTable"),f=p("ConfirmPopup");return g(),v("div",null,[u(m,{value:o.response.questionnaires,lazy:!0,ref:"dt",dataKey:"id",loading:o.loading,removableSort:"",selectionMode:"single",onRowSelect:o.onRowSelect},{empty:d(()=>[S(" Nessun template trovato. ")]),default:d(()=>[u(e,{field:"name",header:"Nome"}),u(e,{field:"created_at",header:"Data creazione",sortable:!1},{body:d(({data:T})=>[S(R(o.moment.unix(T.created_at).format("DD/MM/YYYY")),1)]),_:1})]),_:1},8,["value","loading","onRowSelect"]),u(f)])}const B=M(Y,[["render",$]]),I={setup(){const s=w();return{templates:C(()=>s.getters[y.CURRENT_TEMPLATES])}},components:{TemplatesTable:B}},U={class:"flex justify-content-between align-items-center"},j={key:0,class:"uppercase"};function G(s,l,_,o,n,r){const e=p("TemplatesTable"),m=p("Card");return g(),v("div",null,[u(m,null,{content:d(()=>[b("div",U,[o.templates?(g(),v("h1",j,[b("span",null,R(o.templates.total)+" Template questionario",1)])):z("",!0)]),u(e)]),_:1})])}const ee=M(I,[["render",G]]);export{ee as default};
