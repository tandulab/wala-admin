import{V as ee,u as te,h as ae,c as D,j as se,k as y,g as oe,W as ne,X as V,Y as ie,m as M,D as le,Z as X,_ as re,a as c,b as u,d as a,w as E,t as v,E as I,O as L,e as f,r as R,o as l,f as O,y as U,$ as ce,a0 as de,q as T,z as pe}from"../index81725.js";import{h as z,s as ue}from"./loader81725.js";const _e=function(e){return e.params.id!==void 0?e.params.id:""},he=ee({name:"ReportView",setup(){const e=te(),d=ae(),i=D(()=>e.getters[X.CURRENT_REPORT]),F=D(()=>e.getters[X.CURRENT_REPORT_UPDATED_AT]),H=D(()=>e.getters["auth/isUserSuperAdmin"]),j=D(()=>e.getters["auth/isUserAdmin"]),x=se(),$=y({icon:"pi pi-home",to:"/campagne"}),g=y([{label:"Report"}]),A=["Carichi di cura","Economico - Finanziarie","Salute e benessere","Mobilit\xE0 e trasporto","Formazione","Tempo libero"],m=y(),w=y(),C=y(),B=D(()=>({chartData:{datasets:[{data:i.value!=null?i.value.sections:[],backgroundColor:["#cd1867","#DB4CB3","#EABB3D","#B958D8","#a1c653","#009265"]}],labels:A},chartOptions:{maintainAspectRatio:.5,plugins:{legend:{display:!1},tooltip:{callbacks:{label:t=>`${t.formattedValue}`}}},scales:{y:{ticks:{display:!1}}}}})),o=y(),b=()=>{if(F.value=="")return!1;let t=F.value;if(t&&/^\d+$/.test(t)){const n=parseInt(t)*1e3,h=new Date(n),p=new Date("2025-09-16");return p.setHours(0,0,0,0),h.setHours(0,0,0,0),h>=p}if(t&&t.includes("/")){const n=t.split("/");n.length===3&&(t=`${n[2]}-${n[1].padStart(2,"0")}-${n[0].padStart(2,"0")}`)}const s=new Date("2025-09-16"),r=new Date(t);return s.setHours(0,0,0,0),r.setHours(0,0,0,0),r>=s},P=()=>{const t=[{label:"Et\xE0",code:"age",items:[]},{label:"Genere",code:"genre",items:[{label:"Maschio",value:"filter_gender_m"},{label:"Femmina",value:"filter_gender_f"},{label:"Altro/Preferisco non rispondere",value:"filter_gender_a"}]}];return b()&&t.push({label:"Fascia d'et\xE0 dei figli",code:"child_age",items:[{label:"0-2 anni",value:"filter_child_age_0_2"},{label:"3-6 anni",value:"filter_child_age_3_6"},{label:"7-11 anni",value:"filter_child_age_7_11"},{label:"12-14 anni",value:"filter_child_age_12_14"},{label:"15-18 anni",value:"filter_child_age_15_18"},{label:"18 anni o pi\xF9",value:"filter_child_age_over_18"}]}),t},S=y(P()),Y=D(()=>b()?"Filtra per et\xE0 o genere o per fascia d'et\xE0 dei figli":"Filtra per et\xE0 o genere"),Z=async function(t){try{const s=await e.dispatch(V.FETCH_REPORT_DETAIL,t);return W(),N(),S.value=P(),Q(),s}catch(s){z(e),M(d,s)}},G=async function(){w.value=_e(x);const t=new Map;if(o.value&&t.set("filter",o.value),t.set("report_id",w.value),w.value!="")if(x.name=="dettaglio-report")$.value={icon:"pi pi-home",to:"/reports"},await Z(t);else try{const s=await e.dispatch(V.SHOW,t);return W(),N(),S.value=P(),Q(),s}catch(s){z(e),M(d,s)}},N=()=>{C.value=[],i.value.answers[0].forEach(t=>{C.value.push(J(t))})},J=t=>{const s=[],r=[];if(i.value!=null)return t.answers.forEach(n=>{s.push(n.total),r.push(n.showrt_answer_label)}),{chartData:{datasets:[{data:s,backgroundColor:["#6EF0D2","#DB4CB3","#EABB3D","#F0A68F"]}],labels:r},chartOptions:{indexAxis:"y",maintainAspectRatio:.5,plugins:{title:{display:!1,text:`${t.question_label} - Rispondenti: ${t.answer_count} su ${i.value.completed}`},legend:{display:!1},tooltip:{callbacks:{label:()=>"",title:n=>[`${s[n[0].dataIndex]} risposte`,`${Math.round(s[n[0].dataIndex]*100/t.answer_count)}% del campione`,`${Math.round(s[n[0].dataIndex]*100/i.value.completed)}% del totale`]}}}},question:`${t.question_label} - Rispondenti: ${t.answer_count} su ${i.value.completed} `}},q=(t,s)=>{const r=[],n=[],h=[];if(i.value!=null)return t.answers.forEach(p=>{r.push(p.total),h.push(p.showrt_answer_label),n.push(p.answer_label),t.answer_count*100/i.value.completed}),{chartData:{datasets:[{data:r,backgroundColor:s}],labels:h},chartOptions:{maintainAspectRatio:.5,plugins:{title:{display:!0},legend:{display:!1},tooltip:{callbacks:{label:()=>"",title:p=>[`${n[p[0].dataIndex]}`,`${r[p[0].dataIndex]} risposte`,`${Math.round(r[p[0].dataIndex]*100/t.answer_count)}% del campione`,`${Math.round(r[p[0].dataIndex]*100/i.value.completed)}% del totale`]}}}},question:`${t.question_label} <br> Rispondenti: ${t.answer_count} su ${i.value.completed} `}},W=()=>{if(m.value=[],A.forEach(t=>{let s={title:t,content:[]};m.value.push(s)}),i.value.answers)for(let t in i.value.answers)switch(+t){case 1:{k(t,"#cd1867",0);break}case 2:k(t,"#DB4CB3",1);break;case 3:k(t,"#EABB3D",2);break;case 4:k(t,"#B958D8",3);break;case 5:k(t,"#a1c653",4);break;case 6:k(t,"#009265",5);break}},k=(t,s,r)=>{i.value.answers[t].forEach(n=>{m.value[r].content.push(q(n,s))})},K=async function(t){let s="";t?s=`/reports/${w.value}/download_report`:s=`/campaigns/${w.value}/download_report`,ue(e);try{const n=await le({method:"get",url:s,responseType:"blob",timeout:6e4});var r=new Blob([n.data],{type:n.headers["content-type"]});const h=document.createElement("a");h.href=window.URL.createObjectURL(r),t?h.download=`report_${i.value.report_title.replace(/\s/g,"_").toLocaleLowerCase()}.xlsx`:h.download=`report_${i.value.campaign_name.replace(/\s/g,"_").toLocaleLowerCase()}.xlsx`,h.click(),z(e)}catch(n){z(e),M(d,n)}},Q=function(){const t=i.value.answers[0][0].answers,s=S.value.find(r=>r.code==="age");s&&(s.items=[{label:t[0].answer_label,value:"filter_age_18"},{label:t[1].answer_label,value:"filter_age_35"},{label:t[2].answer_label,value:"filter_age_55"},{label:t[3].answer_label,value:"filter_age_65"}])};return oe(()=>{G()}),ne(()=>{e.dispatch(V.RESET_REPORT)}),{home:$,items:g,chartSections:B,genericChartData:q,chartsTab0:C,report:i,tabs:m,groupedFilters:S,selectedGroupedFilter:o,route:x,report_updated_at:F,dropdownPlaceholder:Y,downloadReport:K,userIsSuperAdmin:H,isUserAdmin:j,initReport:G,isButtonReportDisabled:ie}}}),me="/assets/user81725.svg",be="/assets/thumbs-up81725.svg",fe="/assets/hourglass81725.svg",ve="/assets/thumbs-down81725.svg";const _=e=>(ce("data-v-0b21c26d"),e=e(),de(),e),ge={class:"dashboard"},we={class:"mb-3"},ye={class:"container"},Ee={class:"col-12 flex align-items-center justify-content-between pb-0"},Re={class:"flex"},ke=_(()=>a("h3",{class:"text-white m-0 mr-3"},"Questionario",-1)),De={key:0,class:"text-white mt-0"},Te={key:1,class:"text-white mt-0"},xe={key:0,class:"col-12 flex align-items-center"},$e=_(()=>a("h3",{class:"text-white m-0 mr-3"},"Inizio",-1)),Ce={class:"text-white mt-0"},Be={key:1,class:"col-12 flex align-items-center"},Fe=_(()=>a("h3",{class:"text-white m-0 mr-3"},"Scadenza",-1)),Ae={class:"text-white mt-0"},Se={key:0,class:"grid justify-content-center align-items-end flex-wrap border-round-sm"},Ie={class:"col-12"},Le={class:"container"},Oe=_(()=>a("h3",null,"Fruizione questionario",-1)),ze={class:"flex align-items-center justify-content-between flex-wrap"},Pe={class:"counter-block border-round-2xl p-3"},Ve={class:"text-white m-0"},Me=_(()=>a("div",{class:"flex align-items-center justify-content-between"},[T(" Iscritti "),a("img",{src:me,class:"h-2rem"})],-1)),Ue={class:"counter-block border-round-2xl p-3"},He={class:"text-white m-0"},je=_(()=>a("div",{class:"flex align-items-center justify-content-between"},[T(" Concluso "),a("img",{src:be,class:"h-2rem"})],-1)),Ge={class:"counter-block border-round-2xl p-3"},Ne={class:"text-white m-0"},qe=_(()=>a("div",{class:"flex align-items-center justify-content-between"},[T(" Iniziato "),a("img",{src:fe,class:"h-2rem"})],-1)),We={class:"counter-block border-round-2xl p-3"},Qe={class:"text-white m-0"},Xe=_(()=>a("div",{class:"flex align-items-center justify-content-between"},[T(" Non iniziato "),a("img",{src:ve,class:"h-2rem"})],-1)),Ye={class:"col-12 pl-0 ml-0 mb-0"},Ze=_(()=>a("h3",{class:"mb-0"},"Risultati",-1)),Je={class:"flex justify-content-end mt-0 mb-2"},Ke={class:"wrapper-charts"},et={class:"flex"},tt={class:""},at=_(()=>a("h3",{class:"mt-3"},"Bisogni",-1)),st=_(()=>a("p",{class:"mb-6 font-italic line-height-2"},[T(" I punteggi assegnati alle singole aree previste dal grafico indicano l\u2019intensit\xE0 di bisogno rilevata nella popolazione aziendale. Pi\xF9 alto il punteggio, maggiore l\u2019intensit\xE0 di bisogno rilevata nella specifica area."),a("br"),T(" Si noti bene che il punteggio non si riferisce ad una porzione percentuale della popolazione aziendale. ")],-1)),ot={key:0,class:"flex row-gap-3 flex-column"},nt={class:"text-center font-semibold"},it=["innerHTML"],lt={class:"pi pi-info-circle cursor-pointer"},rt={key:0,class:"flex flex-wrap"},ct={class:"text-center font-semibold"},dt=["innerHTML"],pt={class:"pi pi-info-circle cursor-pointer"},ut={class:"text-center font-semibold"},_t=["innerHTML"],ht={class:"pi pi-info-circle cursor-pointer"};function mt(e,d,i,F,H,j){const x=R("Breadcrumb"),$=R("Button"),g=R("Card"),A=R("Dropdown"),m=R("Chart"),w=R("TabPanel"),C=R("TabView"),B=pe("tooltip");return l(),c("div",ge,[u(x,{home:e.home,model:e.items,class:"mb-3 mt-0 pt-0"},null,8,["home","model"]),a("div",we,[u(g,{class:"box py-2"},{content:E(()=>{var o;return[a("div",ye,[a("div",Ee,[a("div",Re,[ke,e.report&&e.report.campaign_name?(l(),c("span",De,v(e.report.campaign_name),1)):f("",!0),e.report&&e.report.report_title?(l(),c("span",Te,v(e.report.report_title),1)):f("",!0)]),(e.isUserAdmin||e.userIsSuperAdmin)&&e.route.name!="dettaglio-report"?(l(),O($,{key:0,class:"p-button-outlined p-button-secondary",label:"Scarica Report",onClick:d[0]||(d[0]=b=>e.downloadReport(!1)),disabled:e.isButtonReportDisabled((o=e.report)==null?void 0:o.campaign_start_at)},null,8,["disabled"])):f("",!0),(e.isUserAdmin||e.userIsSuperAdmin)&&e.route.name=="dettaglio-report"?(l(),O($,{key:1,class:"p-button-outlined p-button-secondary",label:"Scarica Report",onClick:d[1]||(d[1]=b=>e.downloadReport(!0)),disabled:e.isButtonReportDisabled(e.report_updated_at)},null,8,["disabled"])):f("",!0)]),e.report&&e.report.campaign_start_at?(l(),c("div",xe,[$e,a("span",Ce,v(e.report.campaign_start_at),1)])):f("",!0),e.report&&e.report.campaign_end_at?(l(),c("div",Be,[Fe,a("span",Ae,v(e.report.campaign_end_at),1)])):f("",!0)])]}),_:1})]),e.report?(l(),c("div",Se,[a("div",Ie,[a("div",Le,[Oe,a("div",ze,[a("div",Pe,[a("h2",Ve,v(e.report.total),1),Me]),a("div",Ue,[a("h2",He,v(e.report.completed),1),je]),a("div",Ge,[a("h2",Ne,v(e.report.started),1),qe]),a("div",We,[a("h2",Qe,v(e.report.total-e.report.completed-e.report.started),1),Xe])]),a("div",Ye,[Ze,a("div",Je,[u(A,{modelValue:e.selectedGroupedFilter,"onUpdate:modelValue":d[2]||(d[2]=o=>e.selectedGroupedFilter=o),options:e.groupedFilters,optionLabel:"label",optionValue:"value",optionGroupLabel:"label",optionGroupChildren:"items",placeholder:e.dropdownPlaceholder,onChange:d[3]||(d[3]=o=>e.initReport()),showClear:!0},null,8,["modelValue","options","placeholder"])])]),a("div",Ke,[a("div",et,[u(g,null,{content:E(()=>[a("div",tt,[a("div",null,[at,st,u(m,{type:"bar",data:e.chartSections.chartData,options:e.chartSections.chartOptions},null,8,["data","options"])])])]),_:1})]),e.chartsTab0?(l(),c("div",ot,[(l(!0),c(I,null,L(e.chartsTab0.slice(0,2),o=>(l(),O(g,{key:o},{content:E(()=>[a("div",nt,[a("span",{innerHTML:o.question,class:"line-height-3"},null,8,it),U(a("i",lt,null,512),[[B,"Il questionario \xE8 adattivo e mostra le domande solo agli utenti in target. La domanda \xE8 stata posta ad un campione selezionato di utenti. Passando il mouse sul grafico \xE8 possibile accedere alle statistiche di approfondimento.",void 0,{top:!0}]])]),u(m,{type:"bar",data:o.chartData,options:o.chartOptions},null,8,["data","options"])]),_:2},1024))),128))])):f("",!0)]),e.chartsTab0?(l(),c("div",rt,[(l(!0),c(I,null,L(e.chartsTab0.slice(2),o=>(l(),c("div",{class:"col-6",key:o},[u(g,null,{content:E(()=>[a("div",ct,[a("span",{innerHTML:o.question,class:"line-height-3"},null,8,dt),U(a("i",pt,null,512),[[B,"Il questionario \xE8 adattivo e mostra le domande solo agli utenti in target. La domanda \xE8 stata posta ad un campione selezionato di utenti. Passando il mouse sul grafico \xE8 possibile accedere alle statistiche di approfondimento.",void 0,{top:!0}]])]),u(m,{type:"bar",data:o.chartData,options:o.chartOptions},null,8,["data","options"])]),_:2},1024)]))),128))])):f("",!0),u(g,{class:"mt-4"},{content:E(()=>[u(C,null,{default:E(()=>[(l(!0),c(I,null,L(e.tabs,o=>(l(),O(w,{key:o.title,header:o.title},{default:E(()=>[(l(!0),c(I,null,L(o.content,b=>(l(),c("div",{key:b,class:"my-4 xs:col-12 xs:col-offset-0 lg:col-8 lg:col-offset-2"},[a("div",ut,[a("span",{innerHTML:b.question,class:"line-height-3"},null,8,_t),U(a("i",ht,null,512),[[B,"Il questionario \xE8 adattivo e mostra le domande solo agli utenti in target. La domanda \xE8 stata posta ad un campione selezionato di utenti. Passando il mouse sul grafico \xE8 possibile accedere alle statistiche di approfondimento.",void 0,{top:!0}]])]),u(m,{type:"bar",data:b.chartData,options:b.chartOptions},null,8,["data","options"])]))),128))]),_:2},1032,["header"]))),128))]),_:1})]),_:1})])])])):f("",!0)])}const vt=re(he,[["render",mt],["__scopeId","data-v-0b21c26d"]]);export{vt as default};
