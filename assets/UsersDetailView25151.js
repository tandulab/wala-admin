import{k as _,j as W,u as X,h as Z,i as $,c as A,z as ee,s as T,G as y,m as f,n as L,B as ae,U as I,M as te,_ as ne,a as g,d as i,b as c,w as M,K as se,r as v,o as p,f as oe,e as E,p as B,v as x}from"../index25151.js";import"./moment25151.js";import{h as m,s as z}from"./loader25151.js";const le={setup(){const k=_({icon:"pi pi-home",to:"/referenti"}),o=_(""),U=_([{label:""}]),a=W(),s=X(),r=Z(),t=_({}),S=$(),h=_(!1),C=_(!1),d=_(!1),b=_(),R=A(()=>s.getters[ae.CURRENT_COMPANIES]),u=A(()=>s.getters[I.CURRENT_USER]),l=A(()=>s.getters[I.CURRENT_USERS]),F=async function(){try{return await s.dispatch(te.FETCH_ALL_COMPANIES)}catch(e){m(s),f(r,e)}},O=async function(){try{const e=await s.dispatch(y.FETCH_USER_DETAIL,a.params.id+"");return j(),e}catch(e){m(s),f(r,e)}},P=async function(){if(V()||N()||w())return;z(s);const e={user:t.value};try{const n=await s.dispatch(y.UPDATE_USER,e);return T(r,{message:"Referente aggiornato correttamente.",title:""}),L.replace({name:"referenti"}),m(s),n}catch(n){m(s),f(r,n)}},H=async function(){if(V()||N()||w())return;z(s);const e={user:t.value};try{const n=await s.dispatch(y.CREATE_USER,e);return T(r,{message:"Referente creato correttamente.",title:""}),L.replace({name:"referenti"}),m(s),n}catch(n){m(s),f(r,n)}},j=function(){var e;t.value.id=u.value.id,t.value.first_name=u.value.first_name,t.value.last_name=u.value.last_name,t.value.email=u.value.email,t.value.company_id=(e=u.value.company)==null?void 0:e.id},G=function(){if(b.value&&t.value.id){if(!t.value.company_id){T(r,{message:"Campo azienda obbligatorio",title:"",error:!0});return}q()}else o.value!=""&&t.value.id?P():H()},q=async function(){const e={user_id:t.value.id,users:{company_id:t.value.company_id}};try{return await s.dispatch(y.ADD_USER_TO_ADMIN,e)}catch(n){m(s),f(r,n)}},N=function(){var e,n;return((e=t.value)==null?void 0:e.last_name)==""||((n=t.value)==null?void 0:n.last_name)==null?C.value=!0:C.value=!1,C.value},V=function(){var e,n;return((e=t.value)==null?void 0:e.first_name)==""||((n=t.value)==null?void 0:n.first_name)==null?h.value=!0:h.value=!1,h.value},w=function(){var e,n;return((e=t.value)==null?void 0:e.email)==""||((n=t.value)==null?void 0:n.email)==null?d.value=!0:d.value=!1,d.value},Y=e=>{S.require({target:e.currentTarget,message:"Sei sicuro di voler inviare le credenziali?",icon:"pi pi-info-circle",acceptClass:"p-button-danger",accept:()=>{K()}})},K=async function(){try{const e=await s.dispatch(y.AUTH_SEND_CREDENTIALS,t.value.id);return T(r,{message:"Credenziali inviate correttamente.",title:""}),e}catch(e){m(s),f(r,e)}},J=async function(e){const n=new Map;n.set("email",e.query),n.set("per_page",1e6);try{return await s.dispatch(y.FETCH_ALL_USERS,n)}catch(D){m(s),f(r,D)}},Q=function(e){t.value.first_name=e.value.first_name,t.value.last_name=e.value.last_name,t.value.email=e.value.email,t.value.id=e.value.id};return ee(async()=>{F(),o.value=a.params.id+"",o.value!=""?(O(),U.value[0]={label:"Modifica referente"}):U.value[0]={label:"Nuovo referente"}}),{user_detail:u,home:k,items:U,response:R,tmp_user:t,invalid_first_name:h,invalid_last_name:C,invalid_email:d,search_email:b,resp_users:l,route:a,saveUser:G,validateLastName:N,validateFirstName:V,validateEmail:w,confirmSendCredential:Y,fetchAllUsers:J,onSelectUser:Q}},components:{}};const ie={class:"m-4"},re={class:"flex align-items-center justify-content-between"},ce=i("h1",null,"REFERENTE",-1),me={key:0},de={class:"formgrid flex col-10 pl-0"},ue={class:"field col-6 flex flex-column"},_e=i("label",{for:"name"},"Email",-1),ve={class:"formgrid grid col-10"},fe={class:"field col-6"},pe=i("label",{for:"name"},"Nome*",-1),he={key:0,id:"name",class:"p-error"},Ce={class:"field col-6"},ye=i("label",{for:"name"},"Cognome*",-1),ge={key:0,id:"name",class:"p-error"},Ee={class:"field col-6"},Ue=i("label",{for:"name"},"Email*",-1),Se={key:0,id:"name",class:"p-error"},be={class:"field col-6"},Te={for:"company"},Re={key:0},Ne={class:"flex justify-content-end"};function Ve(k,o,U,a,s,r){const t=v("Breadcrumb"),S=v("Button"),h=v("Message"),C=v("AutoComplete"),d=v("InputText"),b=v("Dropdown"),R=v("Card"),u=v("ConfirmPopup");return p(),g(se,null,[i("div",ie,[c(t,{home:a.home,model:a.items,class:"mb-3 mt-0 pt-0"},null,8,["home","model"]),c(R,null,{content:M(()=>[i("div",re,[ce,a.tmp_user.id?(p(),oe(S,{key:0,label:"Invia credenziali",onClick:o[0]||(o[0]=l=>a.confirmSendCredential(l)),class:"p-button-outlined"})):E("",!0)]),a.route.params.id?E("",!0):(p(),g("div",me,[c(h,{severity:"info"},{default:M(()=>[B("Seleziona un utente indicando la sua email oppure compila il form sottostante")]),_:1}),i("div",de,[i("div",ue,[_e,c(C,{modelValue:a.search_email,"onUpdate:modelValue":o[1]||(o[1]=l=>a.search_email=l),suggestions:a.resp_users.users,forceSelection:"",onComplete:o[2]||(o[2]=l=>a.fetchAllUsers(l)),optionLabel:"email",optionValue:"id",id:"search-user",onItemSelect:o[3]||(o[3]=l=>a.onSelectUser(l))},null,8,["modelValue","suggestions"])])])])),i("div",ve,[i("div",fe,[pe,c(d,{id:"name",type:"text",modelValue:a.tmp_user.first_name,"onUpdate:modelValue":o[4]||(o[4]=l=>a.tmp_user.first_name=l),class:x(["w-full",{"p-invalid":a.invalid_first_name}]),onChange:a.validateFirstName},null,8,["modelValue","class","onChange"]),a.invalid_first_name?(p(),g("small",he,"Campo obbligatorio.")):E("",!0)]),i("div",Ce,[ye,c(d,{id:"name",type:"text",modelValue:a.tmp_user.last_name,"onUpdate:modelValue":o[5]||(o[5]=l=>a.tmp_user.last_name=l),class:x(["w-full",{"p-invalid":a.invalid_last_name}]),onChange:a.validateLastName},null,8,["modelValue","class","onChange"]),a.invalid_last_name?(p(),g("small",ge,"Campo obbligatorio.")):E("",!0)]),i("div",Ee,[Ue,c(d,{id:"name",type:"text",modelValue:a.tmp_user.email,"onUpdate:modelValue":o[6]||(o[6]=l=>a.tmp_user.email=l),class:x(["w-full",{"p-invalid":a.invalid_email}]),onChange:a.validateEmail},null,8,["modelValue","class","onChange"]),a.invalid_email?(p(),g("small",Se,"Campo obbligatorio.")):E("",!0)]),i("div",be,[i("label",Te,[B("Azienda"),a.search_email!=""?(p(),g("span",Re,"*")):E("",!0)]),c(b,{modelValue:a.tmp_user.company_id,"onUpdate:modelValue":o[7]||(o[7]=l=>a.tmp_user.company_id=l),options:a.response.companies,optionLabel:"name",optionValue:"id",id:"company",class:"w-full"},null,8,["modelValue","options"])])]),i("div",Ne,[c(S,{label:"Salva",onClick:a.saveUser},null,8,["onClick"])])]),_:1})]),c(u)],64)}const ke=ne(le,[["render",Ve]]);export{ke as default};
